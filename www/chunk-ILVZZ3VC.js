import{c as p,e as h,f as g,g as i,j,k as n,l as $}from"./chunk-ZAFSEONU.js";import{j as R,l as m}from"./chunk-SVTJ7FR3.js";import{a as l,b as d,f as s}from"./chunk-RW4GY4BD.js";var S=(()=>{let c=class c{constructor(e){this.firestore=e,this.nombre="",this.nombrePareja="",this.aniversario=null,this.codigoPareja=null,this.recuerdos=[{titulo:"Registrado",fecha:new Date(2023,10,25),foto:"",completado:!1},{titulo:"No Registrado",fecha:new Date(2023,10,25),foto:"",completado:!1}]}getRecuerdos(){return this.recuerdos}tituloExiste(e){return this.recuerdos.some(o=>o.titulo.toLowerCase()===e.toLowerCase())}addRecuerdo(e){return s(this,null,function*(){if(this.recuerdos.push(e),!!this.codigoPareja)try{let o=i(this.firestore,`parejas/${this.codigoPareja}/recuerdos/${e.titulo}`),t=e.fecha instanceof Date&&!isNaN(e.fecha.getTime())?e.fecha.toISOString():null;yield n(o,d(l({},e),{fecha:t})),console.log(`Recuerdo "${e.titulo}" subido correctamente.`)}catch(o){console.error(`Error al subir el recuerdo "${e.titulo}":`,o)}})}delRecuerdo(e){return s(this,null,function*(){if(this.recuerdos=this.recuerdos.filter(o=>o!==e),this.codigoPareja)try{let o=i(this.firestore,`parejas/${this.codigoPareja}/recuerdos/${e.titulo}`);yield g(o),console.log("Recuerdo eliminado de Firestore")}catch(o){console.error("Error al eliminar recuerdo de Firestore:",o)}else console.warn("No se pudo eliminar de Firestore: Falta ID del recuerdo o c\xF3digo de pareja")})}registrarRecuerdo(e){return s(this,null,function*(){if(this.codigoPareja)try{let o=i(this.firestore,`parejas/${this.codigoPareja}/recuerdos/${e.titulo}`);yield $(o,{foto:e.foto,fecha:e.fecha instanceof Date?e.fecha.toISOString():null,completado:e.completado}),console.log(`Recuerdo "${e.titulo}" actualizado en Firestore.`)}catch(o){console.error("Error al actualizar el recuerdo en Firestore:",o)}})}editarRecuerdo(e,o){return s(this,null,function*(){if(this.codigoPareja)try{let t=`parejas/${this.codigoPareja}/recuerdos`,a=i(this.firestore,`${t}/${e.titulo}`),r=d(l({},e),{titulo:o}),f=i(this.firestore,`${t}/${o}`);yield g(a),yield n(f,r),console.log(`Recuerdo actualizado: "${e.titulo}" ahora es "${o}" en Firestore.`)}catch(t){console.error("Error al actualizar el recuerdo en Firestore:",t)}})}subirRecuerdosAFirebase(e,o,t){return s(this,null,function*(){if(!this.codigoPareja)return;let a=h(t,`parejas/${e}/recuerdos`);for(let r of o){let f=i(a,r.titulo),D=r.fecha instanceof Date&&!isNaN(r.fecha.getTime())?r.fecha.toISOString():null;try{yield n(f,d(l({},r),{fecha:D}),{merge:!0}),console.log(`Recuerdo "${r.titulo}" subido correctamente.`)}catch(w){console.error(`Error al subir el recuerdo "${r.titulo}":`,w)}}console.log("LOS RECUERDOS YA FUERON SUBIDOS")})}syncRecuerdos(){if(!this.codigoPareja)return;let e=h(this.firestore,`parejas/${this.codigoPareja}/recuerdos`);j(e,o=>{this.recuerdos=o.docs.map(t=>{var r;let a=t.data();return{titulo:a.titulo,fecha:(r=a.fecha)!=null&&r.toDate?a.fecha.toDate():new Date(a.fecha),foto:a.foto,completado:a.completado}}),console.log("LOS RECUERDOS YA FUERON BAJADOS")})}};c.\u0275fac=function(o){return new(o||c)(m(p))},c.\u0275prov=R({token:c,factory:c.\u0275fac,providedIn:"root"});let u=c;return u})();export{S as a};
